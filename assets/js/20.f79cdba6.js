(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{372:function(s,t,a){s.exports=a.p+"assets/img/6.4.1.ac69ded3.jpg"},373:function(s,t,a){s.exports=a.p+"assets/img/6.4.2.8be79646.jpg"},430:function(s,t,a){"use strict";a.r(t);var n=a(42),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"introduce-polymorphic-creation-with-factory-method"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#introduce-polymorphic-creation-with-factory-method"}},[s._v("#")]),s._v(" Introduce Polymorphic Creation with Factory Method")]),s._v(" "),n("p",[s._v("以 Factory Method 導入多型創建（Polymorphic Creation）")]),s._v(" "),n("p",[s._v("為該函式製作單個 superclass 版本，稱為 Factory Method，專門處理物件的具現行為（instantiation）。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(372),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"動機"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#動機"}},[s._v("#")]),s._v(" 動機")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://i.imgur.com/3iqE4fL.jpg",alt:""}}),s._v(" "),n("img",{attrs:{src:"https://i.imgur.com/DNZ6jrC.jpg",alt:""}})]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("優點")]),s._v(" "),n("ul",[n("li",[s._v("減少 custom object creation step 所引發的重複")]),s._v(" "),n("li",[s._v("有效表達「創建行為發生於何處」以及「可以怎樣覆寫它」")]),s._v(" "),n("li",[s._v("強迫 class 必須實作「Factory Method 用到的型別」")])])]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("缺點")]),s._v(" "),n("ul",[n("li",[s._v("可能會要求你傳遞非必要參數給某些 Factory Method 實作者")])])]),s._v(" "),n("h2",{attrs:{id:"作法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#作法"}},[s._v("#")]),s._v(" 作法")]),s._v(" "),n("p",[s._v("這個重構方法最常用於下列狀況：")]),s._v(" "),n("ol",[n("li",[s._v("當 sibling subclasses 以類似手法（只有物件創建手段不同）實作某個函式時\n"),n("ul",[n("li",[s._v("註：在繼承體系中，同一個 parent 底下眾旁系 classes，稱為 sibling subclasses")])])]),s._v(" "),n("li",[s._v("當 superclass 和 subclass 以類似手法（只有物件創建手段不同）實作某個函式時")])]),s._v(" "),n("p",[s._v("這裡提供的作法用來處理 sibling subclasses 的情況，並且可以輕易調整用於 superclass 和 subclass 的情況。")]),s._v(" "),n("p",[s._v("當某個函式在繼承體系中被近似實作出來，其中只有物件創建手段不同，此函式稱為 similar 函式。")]),s._v(" "),n("p",[s._v("作法：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("在一個持有 similar 函式的 subclass 中，修改那個函式，以便讓 custom object creation 發生在這些將會呼叫 instantiation method 的步驟。")]),s._v(" "),n("p",[s._v("通常的作法是在 creation code 實施 "),n("em",[s._v("Extract Method")]),s._v("，或是重構 creation code，讓它呼叫一個事先被提煉出來的 instantiation method。")]),s._v(" "),n("p",[s._v("請盡量為 instantiation method 取一個一般化的名稱（e.g. createBuilder, newProduct, ...），因為這些名稱需要用在 sibling subclass 的 similar 函式上。\n讓 instantiation method 返回型別為 similar 函式的 custom instantiation logic 的共通型別。")]),s._v(" "),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("對其他 sibling subclasses 的 similar 函式重複進行步驟 1。\n這會讓每個 sibling subclass 內建立一個 instantiation method，而且這個函式的 signature 在每個 sibling subclass 中都應該相同。")]),s._v(" "),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("修改 sibling subclasses 的 superclass。\n如果不能改或不想這樣做，可以用 "),n("em",[s._v("Extract Superclass")]),s._v(" 產生一個 superclass（繼承自 sibling subclasses 的 superclass），讓 sibling subclass 繼承新的 superclass。")]),s._v(" "),n("p",[s._v("Sibling subclasses 的 superclass 的參與者的名稱是 Factory Method: Creator。")]),s._v(" "),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("在 similar 函式身上實施 "),n("em",[s._v("Form Template Method")]),s._v("。\n這會連帶使用 "),n("em",[s._v("Pull Up Method")]),s._v("。\n當你實施這個重構的時候，一定要實踐下列忠告，他們來自 "),n("em",[s._v("Pull Up Method")]),s._v(" 中的一段詮釋：")]),s._v(" "),n("blockquote",[n("p",[s._v("如果你身處一個強型別語言，而你想要 pull up 的函式呼叫另一個函式，而且被呼叫函式位在兩個 subclasses 上而非 superclass 上，\n那就在 superclass 上宣告一個抽象函式。")])]),s._v(" "),n("p",[s._v("你在 superclass 宣告的抽象函式會成為你的 instantiation method。\n宣告了抽象函式，也就實現了一個 "),n("strong",[s._v("Factory Method")]),s._v("。\n現在，每個 sibling subclass 都是一個 "),n("strong",[s._v("Factory Method")]),s._v(": ConcreteCreator。")]),s._v(" "),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("如果 sibling subclass 還有其他 similar 函式，請重複步驟 1--4。\n這時候你會因為可以呼叫先前產生的 "),n("strong",[s._v("Factory Method")]),s._v(" 而受惠。")])]),s._v(" "),n("li",[n("p",[s._v("如果多數 ConcreteCreator 的 "),n("strong",[s._v("Factory Method")]),s._v(" 含有相同的 instantiation code，請把程式碼搬到 superclass。\n作法是，先把 superclass 中的 "),n("strong",[s._v("Factory Method")]),s._v(" 宣告式改變成為一個 concrete 的 "),n("strong",[s._v("Factory Method")]),s._v("，讓這個 concrete 函式執行預設（i.e. 大多數情況可接受）的 instantiation method。")]),s._v(" "),n("ul",[n("li",[s._v("編譯並測試")])])])]),s._v(" "),n("h2",{attrs:{id:"範例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#範例"}},[s._v("#")]),s._v(" 範例")]),s._v(" "),n("p",[s._v("作者在某個專案中以 TDD 寫出一個 "),n("code",[s._v("XMLBuilder")]),s._v("，之後又寫一個 "),n("code",[s._v("DOMBuilder")]),s._v("，這個 class 的行為都類似 "),n("code",[s._v("XMLBuilder")]),s._v("，只不過他是透過 DOM 的方式在內部生產 XML 並讓客戶存取 DOM。")]),s._v(" "),n("p",[s._v("為了寫出 "),n("code",[s._v("DOMBuilder")]),s._v("，他複製貼上之前為 "),n("code",[s._v("XMLBuilder")]),s._v(" 寫的測試，修改一個地方：讓他 instantiate "),n("code",[s._v("DOMBuilder")]),s._v(" 而不是 "),n("code",[s._v("XMLBuilder")]),s._v("。")]),s._v(" "),n("p",[s._v("目標：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(373),alt:""}})]),s._v(" "),n("p",[n("code",[s._v("XMLBuilderTest")]),s._v(" 和 "),n("code",[s._v("DOMBuilderTest")]),s._v(" 有很多相同的 tests，DOM 有自己另外的 tests。\n如果不改的話，要在 XML 那邊修改的同時也要在 DOM 那邊修改。\n因此要 refactor to Factory Method，以下是重構過程：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("第一個找到的 similar 函式是測試用的 "),n("code",[s._v("testAddAboveTest()")]),s._v("。\n將其 instantiation logic 提煉成為一個 instantiation method：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DOMBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestCase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OutputBuilder")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" rootName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DOMBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rootName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testAddAboveRoot")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" invalidResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<orders>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<order>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</order>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</orders>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<customer>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</customer>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        builder "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// !!")]),s._v("\n        builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addBelow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addAbove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"customer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expecting java.lang.RuntimeException"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" ignored"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("注意：新寫的 "),n("code",[s._v("createBuilder()")]),s._v(" 的返回型別是 "),n("code",[s._v("OutputBuilder")]),s._v("。\n使用這個型別是因為 sibling subclass "),n("code",[s._v("XMLBuilderTest")]),s._v(" 需要定義他自己的 "),n("code",[s._v("createBuilder(...)")]),s._v("，而我希望 instantiation method 的 signature 在兩個 classes 內相同。")]),s._v(" "),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("現在，對所有 sibling subclasses（本例只有 "),n("code",[s._v("XMLBuilderTest")]),s._v("）進行步驟 1:")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XMLBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestCase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OutputBuilder")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" rootName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XMLBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rootName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testAddAboveRoot")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" invalidResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<orders>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<order>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</order>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</orders>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<customer>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</customer>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        builder "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// !!")]),s._v("\n        builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addBelow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addAbove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"customer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expecting java.lang.RuntimeException"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" ignored"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("現在要修改測試碼的 superclass。\n但這個 superclass 是 "),n("code",[s._v("TestCase")]),s._v("，是 JUnit 框架的一部分，沒辦法改。\n所以使用 "),n("em",[s._v("Extract Superclass")]),s._v(" 產生 "),n("code",[s._v("AbstractBuilderTest")]),s._v("，它成為我的 test classes 的新 superclass：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestCase")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XMLBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DOMBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("現在可以使出 "),n("em",[s._v("Form Template Method")]),s._v("。\n由於 similar 函式目前在 "),n("code",[s._v("XMLBuilderTest")]),s._v(" 和 "),n("code",[s._v("DOMBuilderTest")]),s._v(" 中相同，"),n("em",[s._v("Form Template Method")]),s._v(" 的作法指示我在 "),n("code",[s._v("testAddAboveRoot()")]),s._v(" 上面實施 "),n("em",[s._v("Pull Up Method")]),s._v("。\n這些作法首先引導我在 "),n("code",[s._v("builder")]),s._v(" 上面運用 "),n("em",[s._v("Pull Up Field")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestCase")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OutputBuilder")]),s._v(" builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XMLBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OutputBuilder")]),s._v(" builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// deleted")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DOMBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OutputBuilder")]),s._v(" builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// deleted")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("繼續 "),n("code",[s._v("testAddAboveRoot()")]),s._v(" 的 "),n("em",[s._v("Pull Up Method")]),s._v("，現在我發現，我必須為任何「被 "),n("code",[s._v("testAddAboveRoot()")]),s._v(" 呼叫且位於 "),n("code",[s._v("XMLBuilderTest")]),s._v(" 和 "),n("code",[s._v("DOMBuilderTest")]),s._v("」的函式，在 superclass 內宣告其抽象函式。\n"),n("code",[s._v("createBuilder(...)")]),s._v(" 正是這樣的函式，因此我 pull up "),n("code",[s._v("testAddAboveRoot()")]),s._v(" 到 "),n("code",[s._v("AbstractBuilderTest")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractBuilderTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestCase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testAddAboveRoot")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" invalidResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<orders>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<order>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</order>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</orders>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<customer>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"</customer>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    builder "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addBelow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addAbove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"customer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expecting java.lang.RuntimeException"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" ignored"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("ul",[n("li",[s._v("編譯並測試")])])]),s._v(" "),n("li",[n("p",[s._v("對其他 similar 函式重複步驟 1--4")])]),s._v(" "),n("li",[n("p",[s._v("現在考慮要不要在 "),n("code",[s._v("AbstractBuilderTest")]),s._v(" 中為 "),n("code",[s._v("createBuilder(...)")]),s._v(" 建立一個預設實作。\n只有當這有助於減少 "),n("code",[s._v("createBuilder(...)")]),s._v(" 多個實作碼的重複碼才這麼做，但在這個例子沒有，所以就不用了。")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);